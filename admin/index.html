<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OfflineClub | Admin Dashboard</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="//offlineclub.com.br/wp-content/uploads/2025/04/cropped-offlinefavicon-32x32.png"
        sizes="32x32">
    <link rel="icon" href="//offlineclub.com.br/wp-content/uploads/2025/04/cropped-offlinefavicon-192x192.png"
        sizes="192x192">
    <link rel="apple-touch-icon"
        href="//offlineclub.com.br/wp-content/uploads/2025/04/cropped-offlinefavicon-180x180.png">

    <!-- Styles -->
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pill {
            border-radius: 9999px;
            padding: 0.5rem 1.25rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .pill:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        @keyframes reveal {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-reveal {
            animation: reveal 0.5s ease-out forwards;
        }

        .delay-100 {
            animation-delay: 0.1s;
        }

        .delay-200 {
            animation-delay: 0.2s;
        }

        .delay-300 {
            animation-delay: 0.3s;
        }
    </style>

    <!-- Phosphor Icons (Script version for better compatibility) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { createRoot } = ReactDOM;

        // Firebase Globals
        const firebaseConfig = {
            projectId: "offlineclub-admin-2025",
            appId: "1:548650740560:web:cb4aea73bbd005b1785a55",
            storageBucket: "offlineclub-admin-2025.firebasestorage.app",
            apiKey: "AIzaSyB35dGg37sgbgB-EOV1qMAHGvqhaTm54lE",
            authDomain: "offlineclub-admin-2025.firebaseapp.com",
            messagingSenderId: "548650740560"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- COMPONENTS ---

        const StatCard = ({ label, value, icon, color }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [value]);

            return (
                <div className="relative overflow-hidden bg-white/5 border border-white/10 p-6 rounded-2xl group hover:bg-white/10 transition-all duration-500 animate-reveal">
                    <div className={`absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-30 group-hover:scale-125 group-hover:rotate-6 group-hover:-translate-y-2 transition-all duration-700 ease-out pointer-events-none ${color}`}>
                        <i data-lucide={icon} className="w-16 h-16 transform rotate-12"></i>
                    </div>
                    <div className="relative z-10 flex flex-col gap-1">
                        <div className={`flex items-center gap-2 text-sm font-medium ${color}`}>
                            <i data-lucide={icon} className="w-4 h-4"></i>
                            {label}
                        </div>
                        <h3 className="text-3xl font-bold text-white mt-1">{value}</h3>
                    </div>
                </div>
            );
        };

        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message, type = 'danger' }) => {
            if (!isOpen) return null;

            const isSuccess = type === 'success';
            const isDanger = type === 'danger';

            return (
                <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in">
                    <div className="bg-[#0a0a0a] border border-white/10 rounded-3xl w-full max-w-sm overflow-hidden shadow-2xl animate-fade-in-up">
                        <div className="p-8 flex flex-col items-center text-center gap-6">
                            <div className={`w-16 h-16 rounded-full flex items-center justify-center ${isSuccess ? 'bg-emerald-500/10 text-emerald-400' : 'bg-red-500/10 text-red-400'}`}>
                                <i data-lucide={isSuccess ? 'check-circle' : 'alert-triangle'} className="w-8 h-8"></i>
                            </div>
                            <div className="space-y-2">
                                <h3 className="text-xl font-bold text-white">{title}</h3>
                                <p className="text-sm text-gray-400 leading-relaxed">{message}</p>
                            </div>
                            <div className="flex gap-3 w-full">
                                {onConfirm && (
                                    <button
                                        onClick={() => { onConfirm(); onClose(); }}
                                        className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all ${isSuccess ? 'bg-emerald-600 hover:bg-emerald-500' : 'bg-red-600 hover:bg-red-500'} text-white`}
                                    >
                                        Continuar
                                    </button>
                                )}
                                <button
                                    onClick={onClose}
                                    className={`flex-1 py-3 rounded-xl text-sm font-bold transition-all bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white border border-white/10`}
                                >
                                    {onConfirm ? 'Cancelar' : 'Fechar'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Login = () => {
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState(null);
            const [loggingIn, setLoggingIn] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError(null);
                setLoggingIn(true);
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (err) {
                    console.error("Login failed", err);
                    let msg = "Credenciais inv√°lidas.";
                    if (err.code === 'auth/user-not-found') msg = "Usu√°rio n√£o encontrado.";
                    if (err.code === 'auth/wrong-password') msg = "Senha incorreta.";
                    setError(msg);
                } finally {
                    setLoggingIn(false);
                }
            };

            return (
                <div className="min-h-screen w-full bg-[#0a0a0a] text-white flex items-center justify-center relative overflow-hidden">
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-900/20 via-black to-black"></div>

                    <div className="glass border border-white/10 p-10 rounded-3xl z-10 w-full max-w-md backdrop-blur-xl shadow-2xl relative">
                        <div className="text-center mb-8">
                            <i className="ph-fill ph-lock-key text-5xl text-purple-500 mb-4 inline-block"></i>
                            <h1 className="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">Admin Access</h1>
                        </div>

                        <form onSubmit={handleLogin} className="flex flex-col gap-5">
                            <div className="space-y-2">
                                <label className="text-xs uppercase tracking-wider text-gray-500 font-semibold">Email</label>
                                <div className="relative">
                                    <i className="ph ph-envelope absolute left-4 top-3.5 text-gray-400"></i>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        className="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-gray-600"
                                        placeholder="admin@offlineclub.com"
                                        required
                                    />
                                </div>
                            </div>
                            <div className="space-y-2">
                                <label className="text-xs uppercase tracking-wider text-gray-500 font-semibold">Senha</label>
                                <div className="relative">
                                    <i className="ph ph-lock-key-open absolute left-4 top-3.5 text-gray-400"></i>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-11 pr-4 text-white focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500 transition-all placeholder-gray-600"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        required
                                    />
                                </div>
                            </div>

                            {error && <div className="bg-red-500/10 border border-red-500/20 text-red-400 text-sm p-3 rounded-lg flex items-center gap-2 animate-pulse"><i className="ph-fill ph-warning-circle"></i>{error}</div>}

                            <button type="submit" disabled={loggingIn} className="mt-4 bg-white text-black hover:bg-gray-200 font-bold py-3.5 rounded-xl transition-all flex items-center justify-center gap-2 shadow-[0_0_20px_rgba(255,255,255,0.1)] hover:shadow-[0_0_25px_rgba(255,255,255,0.2)] disabled:opacity-50 disabled:cursor-not-allowed">
                                {loggingIn ? <i className="ph ph-spinner animate-spin"></i> : <>Entrar <i className="ph-bold ph-arrow-right"></i></>}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Dashboard = () => {
            const [user, setUser] = useState(null);
            const [rawVisits, setRawVisits] = useState([]);
            const [rawClicks, setRawClicks] = useState([]);
            const [rawLeads, setRawLeads] = useState([]);
            const [partners, setPartners] = useState([]);
            const [loading, setLoading] = useState(true);
            const [dateRange, setDateRange] = useState('7d');

            // Partner Management State
            const [showPartnerModal, setShowPartnerModal] = useState(false);
            const [modal, setModal] = useState({ show: false, title: '', message: '', onConfirm: null, type: 'danger' });

            const showNotify = (title, message, type = 'success') => setModal({ show: true, title, message, onConfirm: null, type });
            const showConfirm = (title, message, onConfirm) => setModal({ show: true, title, message, onConfirm, type: 'danger' });
            const [newPartnerName, setNewPartnerName] = useState("");
            const [newPartnerSlug, setNewPartnerSlug] = useState("");
            const [newPartnerEmail, setNewPartnerEmail] = useState("");
            const [editingPartnerId, setEditingPartnerId] = useState(null);

            const SUPREME_ADMINS = ['loohansb@gmail.com', 'vinitroncoso@gmail.com'];
            const isSupreme = SUPREME_ADMINS.includes(user?.email?.toLowerCase());

            // Partner role detection: check if user email matches any partner's email
            const currentPartner = useMemo(() => {
                if (!user || isSupreme) return null;
                return partners.find(p => p.email?.toLowerCase() === user.email?.toLowerCase());
            }, [user, partners, isSupreme]);

            const isPartner = !!currentPartner;
            const partnerSlug = currentPartner?.slug || null;

            // Refs
            const visitsChartRef = useRef(null);
            const sourcesChartRef = useRef(null);

            useEffect(() => {
                return auth.onAuthStateChanged(u => {
                    setUser(u);
                    setLoading(false);
                });
            }, []);

            // Data Fetching
            useEffect(() => {
                if (!user) return;

                const unsubVisits = db.collection('visits').orderBy('timestamp', 'desc').limit(500)
                    .onSnapshot(snp => setRawVisits(snp.docs.map(d => ({ id: d.id, ...d.data() }))));

                const unsubClicks = db.collection('clicks').orderBy('timestamp', 'desc').limit(500)
                    .onSnapshot(snp => setRawClicks(snp.docs.map(d => ({ id: d.id, ...d.data() }))));

                const unsubPartners = db.collection('partners').onSnapshot(snp =>
                    setPartners(snp.docs.map(d => ({ id: d.id, ...d.data() })))
                );

                const unsubLeads = db.collection('leads').orderBy('timestamp', 'desc').limit(500)
                    .onSnapshot(snp => setRawLeads(snp.docs.map(d => ({ id: d.id, ...d.data() }))));

                return () => { unsubVisits(); unsubClicks(); unsubPartners(); unsubLeads(); };
            }, [user]);

            // Partner Management Functions
            const handleAddPartner = async (e) => {
                e.preventDefault();
                if (!newPartnerName || !newPartnerSlug) return;
                try {
                    const data = {
                        name: newPartnerName,
                        slug: newPartnerSlug,
                        email: newPartnerEmail || '',
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    if (editingPartnerId) {
                        await db.collection('partners').doc(editingPartnerId).update(data);
                        showNotify("Atualizado!", "Dados do s√≥cio atualizados com sucesso.");
                    } else {
                        data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection('partners').add(data);
                        showNotify("Sucesso!", "S√≥cio cadastrado com sucesso.");
                    }

                    resetPartnerForm();
                } catch (err) {
                    console.error("Error saving partner", err);
                    showNotify("Erro!", "Houve um problema ao salvar o s√≥cio.", "danger");
                }
            };

            const resetPartnerForm = () => {
                setNewPartnerName("");
                setNewPartnerSlug("");
                setNewPartnerEmail("");
                setEditingPartnerId(null);
            };

            const handleEditPartner = (p) => {
                setNewPartnerName(p.name);
                setNewPartnerSlug(p.slug);
                setNewPartnerEmail(p.email || "");
                setEditingPartnerId(p.id);
                // Scroll to form (top of modal content)
                const modalContent = document.querySelector('.partner-modal-content');
                if (modalContent) modalContent.scrollTop = 0;
            };

            const handleDeletePartner = async (id) => {
                showConfirm("Remover S√≥cio", "Tem certeza que deseja remover este s√≥cio? Esta a√ß√£o n√£o pode ser desfeita.", async () => {
                    await db.collection('partners').doc(id).delete();
                });
            };

            const handleClearMetrics = async () => {
                showConfirm(
                    "Limpar M√©tricas",
                    "‚ö†Ô∏è ATEN√á√ÉO: Isso vai apagar TODAS as m√©tricas (visitas, cliques e leads) permanentemente. Deseja continuar?",
                    async () => {
                        try {
                            const batch = db.batch();

                            // Buscar todos os documentos
                            const visitsSnp = await db.collection('visits').get();
                            const clicksSnp = await db.collection('clicks').get();
                            const leadsSnp = await db.collection('leads').get();

                            // Adicionar dele√ß√µes ao batch
                            visitsSnp.forEach(doc => batch.delete(doc.ref));
                            clicksSnp.forEach(doc => batch.delete(doc.ref));
                            leadsSnp.forEach(doc => batch.delete(doc.ref));

                            // Executar dele√ß√£o
                            await batch.commit();

                            const totalDeleted = visitsSnp.size + clicksSnp.size + leadsSnp.size;
                            showNotify(
                                "Sucesso!",
                                `${totalDeleted} registros deletados com sucesso! (${visitsSnp.size} visitas, ${clicksSnp.size} cliques, ${leadsSnp.size} leads)`
                            );
                        } catch (err) {
                            console.error("Error clearing metrics", err);
                            showNotify("Erro!", `Erro ao limpar m√©tricas: ${err.message}`, "danger");
                        }
                    }
                );
            };

            const getPartnerName = (slug) => {
                const p = partners.find(p => p.slug === slug);
                return p ? p.name : (slug || 'Direto'); // Show Name if found, else slug/Direto
            };

            // Filtering
            const filterData = (data) => {
                if (dateRange === 'all') return data;
                const now = new Date();
                const past = new Date();
                if (dateRange === '24h') past.setHours(now.getHours() - 24);
                if (dateRange === '7d') past.setDate(now.getDate() - 7);
                if (dateRange === '30d') past.setDate(now.getDate() - 30);

                return data.filter(item => {
                    if (!item.timestamp) return false;
                    const d = item.timestamp.toDate ? item.timestamp.toDate() : new Date(item.timestamp);
                    return d >= past;
                });
            };

            // Apply date filter and partner filter (if user is a partner)
            const filteredVisits = useMemo(() => {
                let data = filterData(rawVisits);
                if (isPartner && partnerSlug) {
                    data = data.filter(v => v.socio === partnerSlug);
                }
                return data;
            }, [rawVisits, dateRange, isPartner, partnerSlug]);

            const filteredClicks = useMemo(() => {
                let data = filterData(rawClicks);
                if (isPartner && partnerSlug) {
                    data = data.filter(c => c.socio === partnerSlug);
                }
                return data;
            }, [rawClicks, dateRange, isPartner, partnerSlug]);

            const filteredLeads = useMemo(() => {
                let data = filterData(rawLeads);
                if (isPartner && partnerSlug) {
                    data = data.filter(l => l.socio === partnerSlug);
                }
                return data;
            }, [rawLeads, dateRange, isPartner, partnerSlug]);

            // Idea 1: Top CTAs (Buttons only, no mute toggle)
            const topCTAs = useMemo(() => {
                const ctas = {};
                filteredClicks.filter(c => c.element !== 'Toggle Mudo').forEach(c => {
                    const label = c.element || 'Bot√£o Desconhecido';
                    ctas[label] = (ctas[label] || 0) + 1;
                });
                return Object.entries(ctas).sort((a, b) => b[1] - a[1]).slice(0, 5);
            }, [filteredClicks]);

            // Idea 3: Sound Engagement
            const soundEngagement = useMemo(() => {
                return filteredClicks.filter(c => c.element === 'Toggle Mudo').length;
            }, [filteredClicks]);

            // Idea 4: Page Paths (Popularity)
            const topPaths = useMemo(() => {
                const paths = {};
                filteredVisits.forEach(v => {
                    const p = v.path === '/' || !v.path ? 'Home' : v.path;
                    paths[p] = (paths[p] || 0) + 1;
                });
                return Object.entries(paths).sort((a, b) => b[1] - a[1]).slice(0, 5);
            }, [filteredVisits]);

            // Idea 5: Partner Quality (CTR)
            const partnerQuality = useMemo(() => {
                const stats = {};
                partners.forEach(p => {
                    const vCount = filteredVisits.filter(v => v.source === p.slug).length;
                    const cCount = filteredClicks.filter(c => c.source === p.slug).length;
                    const ctrValue = vCount > 0 ? (cCount / vCount) * 100 : 0;
                    stats[p.slug] = { name: p.name, visits: vCount, clicks: cCount, ctr: ctrValue.toFixed(1) };
                });

                // Also add "Direto"
                const dVisits = filteredVisits.filter(v => !v.source || v.source === 'Direto').length;
                const dClicks = filteredClicks.filter(c => !c.source || c.source === 'Direto').length;
                const dCtr = dVisits > 0 ? (dClicks / dVisits) * 100 : 0;
                stats['Direto'] = { name: 'Direto', visits: dVisits, clicks: dClicks, ctr: dCtr.toFixed(1) };

                return Object.entries(stats).sort((a, b) => {
                    // 1. More clicks first (Volume)
                    if (b[1].clicks !== a[1].clicks) return b[1].clicks - a[1].clicks;
                    // 2. Higher CTR (Quality)
                    if (parseFloat(b[1].ctr) !== parseFloat(a[1].ctr)) return parseFloat(b[1].ctr) - parseFloat(a[1].ctr);
                    // 3. More visits (Activity)
                    return b[1].visits - a[1].visits;
                });
            }, [partners, filteredVisits, filteredClicks]);

            // Chart Rendering
            useEffect(() => {
                if (loading || !user) return;

                // Visits vs Clicks Chart
                const visitsCtx = document.getElementById('visitsChart');
                if (visitsCtx) {
                    const groupedVisits = {};
                    const groupedClicks = {};

                    // Generate chronological labels based on range
                    const labels = [];
                    const now = new Date();

                    if (dateRange === '24h') {
                        // 24 hours of 5-minute intervals = 288 points
                        for (let i = 288; i >= 0; i--) {
                            const d = new Date(now);
                            d.setMinutes(Math.floor(now.getMinutes() / 5) * 5 - (i * 5));
                            d.setSeconds(0);
                            const label = d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                            if (!labels.includes(label)) {
                                labels.push(label);
                                groupedVisits[label] = 0;
                                groupedClicks[label] = 0;
                            }
                        }
                    } else {
                        const days = dateRange === '7d' ? 7 : (dateRange === '30d' ? 30 : 90);
                        for (let i = days - 1; i >= 0; i--) {
                            const d = new Date(now);
                            d.setDate(now.getDate() - i);
                            const label = d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                            labels.push(label);
                            groupedVisits[label] = 0;
                            groupedClicks[label] = 0;
                        }
                    }

                    filteredVisits.forEach(v => {
                        const date = v.timestamp?.toDate ? v.timestamp.toDate() : new Date();
                        const key = dateRange === '24h'
                            ? date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }).replace(/:\d{2}$/, i => {
                                const mins = parseInt(i.substring(1));
                                return ":" + (Math.floor(mins / 5) * 5).toString().padStart(2, '0');
                            })
                            : date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });

                        // Precise match for 24h (rounding to nearest 5 min bucket)
                        if (dateRange === '24h') {
                            const mins = Math.floor(date.getMinutes() / 5) * 5;
                            const bucket = `${date.getHours().toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
                            if (groupedVisits[bucket] !== undefined) groupedVisits[bucket]++;
                        } else if (groupedVisits[key] !== undefined) {
                            groupedVisits[key]++;
                        }
                    });

                    filteredClicks.forEach(c => {
                        const date = c.timestamp?.toDate ? c.timestamp.toDate() : new Date();
                        if (dateRange === '24h') {
                            const mins = Math.floor(date.getMinutes() / 5) * 5;
                            const bucket = `${date.getHours().toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
                            if (groupedClicks[bucket] !== undefined) groupedClicks[bucket]++;
                        } else {
                            const key = date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                            if (groupedClicks[key] !== undefined) groupedClicks[key]++;
                        }
                    });

                    if (window.visitsChartInst) window.visitsChartInst.destroy();
                    window.visitsChartInst = new Chart(visitsCtx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [
                                {
                                    label: 'Visitas',
                                    data: labels.map(l => groupedVisits[l]),
                                    borderColor: '#3b82f6',
                                    backgroundColor: (context) => {
                                        const ctx = context.chart.ctx;
                                        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                                        gradient.addColorStop(0, 'rgba(59, 130, 246, 0.4)');
                                        gradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
                                        return gradient;
                                    },
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 2,
                                    pointHoverRadius: 5
                                },
                                {
                                    label: 'Cliques',
                                    data: labels.map(l => groupedClicks[l]),
                                    borderColor: '#f97316',
                                    backgroundColor: (context) => {
                                        const ctx = context.chart.ctx;
                                        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                                        gradient.addColorStop(0, 'rgba(249, 115, 22, 0.3)');
                                        gradient.addColorStop(1, 'rgba(249, 115, 22, 0)');
                                        return gradient;
                                    },
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true,
                                    pointRadius: 2,
                                    pointHoverRadius: 5
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    labels: { color: '#94a3b8', boxWidth: 10, font: { size: 10 } }
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false,
                                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                                    titleColor: '#fff',
                                    titleFont: { size: 13, weight: '800' },
                                    bodyColor: '#cbd5e1',
                                    bodyFont: { size: 12 },
                                    borderColor: 'rgba(255,255,255,0.1)',
                                    borderWidth: 1,
                                    padding: 12,
                                    cornerRadius: 12,
                                    boxPadding: 8,
                                    usePointStyle: true,
                                    callbacks: {
                                        title: (items) => {
                                            const item = items[0];
                                            return dateRange === '24h' ? `üïí ${item.label}` : `üìÖ ${item.label}`;
                                        },
                                        label: (context) => {
                                            return ` ${context.dataset.label}: ${context.raw}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'rgba(255,255,255,0.03)' },
                                    ticks: { color: '#4b5563', font: { size: 10 } }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: {
                                        color: '#4b5563',
                                        font: { size: 10 },
                                        maxRotation: 0,
                                        autoSkip: true,
                                        maxTicksLimit: dateRange === '24h' ? 8 : 12
                                    }
                                }
                            },
                            interaction: { mode: 'nearest', axis: 'x', intersect: false }
                        }
                    });
                }

                // Sources Chart (By Partner/Slug)
                const sourcesCtx = document.getElementById('sourcesChart');
                if (sourcesCtx) {
                    const sources = {};
                    filteredVisits.forEach(v => {
                        const s = v.source || 'Direto';
                        const name = getPartnerName(s);
                        sources[name] = (sources[name] || 0) + 1;
                    });

                    const sorted = Object.entries(sources).sort((a, b) => b[1] - a[1]).slice(0, 5);

                    if (window.sourcesChartInst) window.sourcesChartInst.destroy();
                    window.sourcesChartInst = new Chart(sourcesCtx, {
                        type: 'doughnut',
                        data: {
                            labels: sorted.map(i => i[0]),
                            datasets: [{
                                data: sorted.map(i => i[1]),
                                backgroundColor: [
                                    '#3b82f6', // Blue
                                    '#a855f7', // Purple
                                    '#f97316', // Orange
                                    '#10b981', // Green
                                    '#ef4444'  // Red
                                ],
                                borderWeight: 0,
                                borderRadius: 4,
                                spacing: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '70%',
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        color: '#94a3b8',
                                        usePointStyle: true,
                                        padding: 20,
                                        font: { size: 11 }
                                    }
                                }
                            }
                        }
                    });
                    if (window.lucide) window.lucide.createIcons();
                    if (window.lucide) window.lucide.createIcons();
                    if (window.lucide) window.lucide.createIcons();
                }
            }, [filteredVisits, filteredClicks, dateRange, loading, user, partners, showPartnerModal, modal.show, editingPartnerId]);

            if (loading) return <div className="min-h-screen bg-black flex items-center justify-center text-white"><i className="ph ph-spinner animate-spin text-4xl text-purple-500"></i></div>;
            if (!user) return <Login />;

            return (
                <div className="min-h-screen bg-[#0a0a0a] text-white font-sans selection:bg-purple-500/30 pb-12">
                    <nav className="border-b border-white/5 bg-black/50 backdrop-blur-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <img src="https://offlineclub.com.br/wp-content/uploads/2025/03/as.png" alt="OfflineClub Logo" className="h-8 w-auto" />
                            </div>
                            <div className="flex items-center gap-4">
                                {isSupreme && (
                                    <>
                                        <button onClick={handleClearMetrics} className="px-3 py-2 bg-red-600/10 hover:bg-red-600 text-red-400 hover:text-white border border-red-600/20 rounded-lg text-xs font-bold transition-all flex items-center gap-2">
                                            <i className="ph-bold ph-trash"></i> Limpar Dados
                                        </button>
                                        <button onClick={() => setShowPartnerModal(true)} className="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg text-sm font-bold transition-all flex items-center gap-2">
                                            <i className="ph-bold ph-users-three"></i> S√≥cios
                                        </button>
                                    </>
                                )}
                                <div className="flex bg-white/5 rounded-lg p-1 border border-white/5">
                                    {['24h', '7d', '30d', 'all'].map(r => (
                                        <button key={r} onClick={() => setDateRange(r)} className={`px-3 py-1.5 rounded-md text-xs font-bold transition-all ${dateRange === r ? 'bg-white text-black shadow-sm' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}>
                                            {r.toUpperCase()}
                                        </button>
                                    ))}
                                </div>
                                <div className="h-6 w-px bg-white/10 mx-2"></div>
                                <button onClick={() => auth.signOut()} className="text-gray-400 hover:text-white transition-colors flex items-center gap-2 text-sm font-medium group">
                                    <i className="ph ph-sign-out text-lg group-hover:text-red-400 transition-colors"></i> Sair
                                </button>
                            </div>
                        </div>
                    </nav>

                    <main className="max-w-7xl mx-auto px-6 py-8 space-y-8">
                        {/* Stats */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                            <StatCard label="Visitas" value={filteredVisits.length} icon="eye" color="text-purple-400" />
                            <StatCard label="Cliques" value={filteredClicks.length} icon="mouse-pointer-2" color="text-blue-400" />
                            <StatCard label="Som Ativado" value={soundEngagement} icon="volume-2" color="text-pink-400" />
                            <StatCard label="Parceiros" value={partners.length} icon="users" color="text-indigo-400" />
                            <StatCard label="Taxa Conv." value={`${filteredVisits.length ? ((filteredClicks.length / filteredVisits.length) * 100).toFixed(1) : 0}%`} icon="trending-up" color="text-orange-400" />
                        </div>

                        {/* Charts */}
                        <div className="grid lg:grid-cols-2 gap-6">
                            <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal delay-100">
                                <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-200">
                                    <span className="w-8 h-8 rounded-full bg-purple-500/10 flex items-center justify-center"><i data-lucide="line-chart" className="w-4 h-4 text-purple-400"></i></span>
                                    Evolu√ß√£o de Tr√°fego
                                </h3>
                                <div className="h-[300px] w-full relative">
                                    <canvas id="visitsChart"></canvas>
                                </div>
                            </div>
                            <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal delay-200">
                                <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-200">
                                    <span className="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center"><i data-lucide="pie-chart" className="w-4 h-4 text-blue-400"></i></span>
                                    Canais/S√≥cios (Share)
                                </h3>
                                <div className="h-[300px] w-full relative">
                                    <canvas id="sourcesChart"></canvas>
                                </div>
                            </div>
                        </div>

                        {/* Top CTAs & Pages Heatmap */}
                        <div className="grid lg:grid-cols-2 gap-6">
                            <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal">
                                <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-200">
                                    <span className="w-8 h-8 rounded-full bg-orange-500/10 flex items-center justify-center"><i data-lucide="mouse-pointer-click" className="w-4 h-4 text-orange-400"></i></span>
                                    Bot√µes Mais Clicados (CTAs)
                                </h3>
                                <div className="space-y-4">
                                    {topCTAs.map(([label, count], idx) => (
                                        <div key={idx} className="flex flex-col gap-2">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-gray-400 font-medium">{label}</span>
                                                <span className="text-white font-bold">{count} cliques</span>
                                            </div>
                                            <div className="h-2 bg-white/5 rounded-full overflow-hidden">
                                                <div
                                                    className="h-full bg-gradient-to-r from-orange-500 to-orange-400 transition-all duration-1000"
                                                    style={{ width: `${(count / topCTAs[0][1]) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    ))}
                                    {topCTAs.length === 0 && <div className="text-gray-500 text-sm py-8 text-center">Nenhum clique registrado</div>}
                                </div>
                            </div>

                            <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal delay-100">
                                <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-200">
                                    <span className="w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center"><i data-lucide="map" className="w-4 h-4 text-emerald-400"></i></span>
                                    P√°ginas Populares
                                </h3>
                                <div className="space-y-3">
                                    {topPaths.map(([path, count], idx) => (
                                        <div key={idx} className="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5 hover:border-emerald-500/30 transition-all group">
                                            <div className="flex items-center gap-3">
                                                <span className="w-6 h-6 rounded-lg bg-emerald-500/10 text-emerald-400 flex items-center justify-center text-[10px] font-bold">{idx + 1}</span>
                                                <span className="text-sm font-medium text-gray-300 group-hover:text-white">{path}</span>
                                            </div>
                                            <span className="text-xs font-bold text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-md">{count} vists</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Partner Quality (Conversion Table) */}
                        <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal">
                            <h3 className="text-lg font-bold mb-6 flex items-center gap-3 text-gray-200">
                                <span className="w-8 h-8 rounded-full bg-indigo-500/10 flex items-center justify-center"><i data-lucide="trophy" className="w-4 h-4 text-indigo-400"></i></span>
                                Qualidade do Tr√°fego (Convers√£o por S√≥cio)
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                {partnerQuality.map(([slug, data], idx) => (
                                    <div key={idx} className="p-4 rounded-2xl bg-white/5 border border-white/5 hover:border-indigo-500/30 transition-all flex flex-col gap-3 group">
                                        <div className="flex justify-between items-start">
                                            <span className="text-sm font-bold text-white group-hover:text-indigo-400 transition-colors truncate max-w-[120px]">{data.name}</span>
                                            <span className={`text-[10px] font-black px-2 py-0.5 rounded-full ${parseFloat(data.ctr) > 10 ? 'bg-emerald-500/10 text-emerald-400' : 'bg-gray-500/10 text-gray-400'}`}>
                                                {data.ctr}% CTR
                                            </span>
                                        </div>
                                        <div className="flex items-end justify-between">
                                            <div className="flex flex-col">
                                                <span className="text-[10px] uppercase font-bold text-gray-500 tracking-wider">Cliques/Visitas</span>
                                                <span className="text-lg font-black text-white">{data.clicks} / {data.visits}</span>
                                            </div>
                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${idx === 0 && (data.clicks > 0 || data.visits > 0) ? 'bg-amber-400/10 text-amber-400' : 'bg-white/5 text-gray-600'}`}>
                                                {idx === 0 && (data.clicks > 0 || data.visits > 0) ? <i data-lucide="crown" className="w-4 h-4"></i> : <span className="text-xs font-bold">#{idx + 1}</span>}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Leads Table - Show form submissions */}
                        {filteredLeads.length > 0 && (
                            <div className="bg-gradient-to-br from-emerald-500/5 to-emerald-500/0 border border-emerald-500/20 rounded-3xl p-6 lg:p-8 backdrop-blur-sm animate-reveal">
                                <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-emerald-400">
                                    <span className="w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center"><i data-lucide="user-check" className="w-4 h-4 text-emerald-400"></i></span>
                                    Leads Capturados ({filteredLeads.length})
                                </h3>
                                <div className="overflow-x-auto overflow-y-auto max-h-[400px] pr-2 custom-scrollbar">
                                    <table className="w-full text-left border-collapse">
                                        <thead>
                                            <tr className="text-xs uppercase text-gray-500 border-b border-white/5 tracking-wider">
                                                <th className="py-4 px-4 font-semibold">Nome</th>
                                                <th className="py-4 px-4 font-semibold">Email</th>
                                                <th className="py-4 px-4 font-semibold">WhatsApp</th>
                                                {isSupreme && <th className="py-4 px-4 font-semibold">S√≥cio</th>}
                                                <th className="py-4 px-4 font-semibold">Data</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-sm text-gray-300">
                                            {filteredLeads.map((lead, i) => (
                                                <tr key={i} className="border-b border-white/5 hover:bg-emerald-500/5 transition-colors group">
                                                    <td className="py-3 px-4 font-medium text-white">{lead.nome || '-'}</td>
                                                    <td className="py-3 px-4 text-gray-400">{lead.email || '-'}</td>
                                                    <td className="py-3 px-4 text-gray-400 font-mono">{lead.whatsapp || '-'}</td>
                                                    {isSupreme && <td className="py-3 px-4 text-purple-400">{getPartnerName(lead.socio)}</td>}
                                                    <td className="py-3 px-4 text-gray-500 font-mono text-xs">
                                                        {lead.timestamp?.toDate ? lead.timestamp.toDate().toLocaleString('pt-BR') : 'Agora'}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Recent Activity */}
                        <div className="bg-white/5 border border-white/10 rounded-3xl p-6 lg:p-8 backdrop-blur-sm">
                            <h3 className="text-lg font-bold mb-6 flex items-center gap-2 text-gray-200">
                                <span className="w-8 h-8 rounded-full bg-gray-500/10 flex items-center justify-center"><i data-lucide="list" className="w-4 h-4 text-gray-400"></i></span>
                                Atividade Recente
                            </h3>
                            <div className="overflow-x-auto overflow-y-auto max-h-[400px] pr-2 custom-scrollbar">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="text-xs uppercase text-gray-500 border-b border-white/5 tracking-wider">
                                            <th className="py-4 px-4 font-semibold">Tipo</th>
                                            <th className="py-4 px-4 font-semibold">Origem (S√≥cio)</th>
                                            <th className="py-4 px-4 font-semibold">Detalhe</th>
                                            <th className="py-4 px-4 font-semibold">Data</th>
                                        </tr>
                                    </thead>
                                    <tbody className="text-sm text-gray-300">
                                        {[...filteredVisits.map(v => ({ ...v, logType: 'visit' })), ...filteredClicks.map(c => ({ ...c, logType: 'click' }))]
                                            .sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0))
                                            .slice(0, 15).map((item, i) => (
                                                <tr key={i} className="border-b border-white/5 hover:bg-white/5 transition-colors group">
                                                    <td className="py-3 px-4">
                                                        <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-bold ${item.logType === 'visit' ? 'bg-purple-500/10 text-purple-400 border border-purple-500/20' : 'bg-blue-500/10 text-blue-400 border border-blue-500/20'}`}>
                                                            {item.logType === 'visit' ? <><i data-lucide="eye" className="w-3 h-3"></i> VISITA</> : <><i data-lucide="mouse-pointer-2" className="w-3 h-3"></i> CLIQUE</>}
                                                        </span>
                                                    </td>
                                                    <td className="py-3 px-4 font-medium text-white group-hover:text-purple-300 transition-colors">
                                                        {getPartnerName(item.source)}
                                                    </td>
                                                    <td className="py-3 px-4 text-gray-400">
                                                        {item.logType === 'visit' ? (item.path || 'In√≠cio') : (item.element || 'Intera√ß√£o')}
                                                    </td>
                                                    <td className="py-3 px-4 text-gray-500 font-mono text-xs">
                                                        {item.timestamp?.toDate ? item.timestamp.toDate().toLocaleString('pt-BR') : 'Agora'}
                                                    </td>
                                                </tr>
                                            ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        {/* Partner Modal */}
                        {showPartnerModal && (
                            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 p-4">
                                <div className="bg-[#0a0a0a] border border-white/10 rounded-2xl w-full max-w-lg md:max-w-2xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl animate-fade-in-up">
                                    <div className="p-5 md:p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
                                        <h2 className="text-xl font-bold text-white flex items-center gap-2">
                                            <i data-lucide="users-2" className="w-6 h-6 text-purple-500"></i> Gerenciar S√≥cios
                                        </h2>
                                        <button onClick={() => setShowPartnerModal(false)} className="text-gray-400 hover:text-white transition-colors"><i data-lucide="x" className="w-6 h-6"></i></button>
                                    </div>

                                    <div className="p-5 md:p-6 overflow-y-auto space-y-8 custom-scrollbar partner-modal-content">
                                        {/* Add New / Edit */}
                                        <div className="bg-purple-500/5 border border-purple-500/20 rounded-xl p-5 md:p-6">
                                            <h3 className="text-sm font-bold uppercase text-purple-400 mb-4 tracking-wider flex items-center justify-between">
                                                <span className="flex items-center gap-2">
                                                    <i data-lucide={editingPartnerId ? "pencil-line" : "plus-circle"} className="w-4 h-4"></i>
                                                    {editingPartnerId ? "Editar S√≥cio" : "Novo S√≥cio"}
                                                </span>
                                                {editingPartnerId && (
                                                    <button onClick={resetPartnerForm} className="text-[10px] bg-white/5 hover:bg-white/10 px-2 py-1 rounded border border-white/10 transition-all">Cancelar Edi√ß√£o</button>
                                                )}
                                            </h3>
                                            <form onSubmit={handleAddPartner} className="grid md:grid-cols-2 gap-4">
                                                <div className="md:col-span-2">
                                                    <label className="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1.5 block">Nome do S√≥cio</label>
                                                    <input
                                                        type="text"
                                                        value={newPartnerName}
                                                        onChange={e => setNewPartnerName(e.target.value)}
                                                        className="w-full bg-black border border-white/10 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none transition-all placeholder-gray-700 text-sm"
                                                        placeholder="Ex: Jo√£o Silva"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1.5 block">Email do S√≥cio</label>
                                                    <input
                                                        type="email"
                                                        value={newPartnerEmail}
                                                        onChange={e => setNewPartnerEmail(e.target.value)}
                                                        className="w-full bg-black border border-white/10 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none transition-all placeholder-gray-700 text-sm"
                                                        placeholder="email@exemplo.com"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] uppercase tracking-wider text-gray-500 font-bold mb-1.5 block">Slug URL (Ex: joao)</label>
                                                    <input
                                                        type="text"
                                                        value={newPartnerSlug}
                                                        onChange={e => setNewPartnerSlug(e.target.value.toLowerCase().replace(/\s/g, '-'))}
                                                        className="w-full bg-black border border-white/10 rounded-lg px-4 py-3 text-white focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none transition-all placeholder-gray-700 text-sm font-mono"
                                                        placeholder="joao"
                                                        required
                                                    />
                                                </div>
                                                <div className="md:col-span-2">
                                                    <button type="submit" className="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-purple-500/20">
                                                        {editingPartnerId ? "Salvar Altera√ß√µes" : "Adicionar S√≥cio"}
                                                    </button>
                                                </div>
                                            </form>
                                        </div>

                                        {/* List */}
                                        <div className="space-y-4">
                                            <h3 className="text-sm font-bold uppercase text-gray-500 tracking-wider flex items-center gap-2">
                                                <i data-lucide="list" className="w-4 h-4"></i> S√≥cios Cadastrados
                                            </h3>
                                            <div className="grid gap-3">
                                                {partners.map(p => (
                                                    <div key={p.id} className="flex flex-col md:flex-row md:items-center justify-between p-4 bg-white/5 border border-white/10 rounded-xl gap-4 group hover:border-purple-500/30 transition-all">
                                                        <div className="flex flex-col gap-1">
                                                            <div className="text-white font-bold flex items-center gap-2">
                                                                {p.name}
                                                                {p.email && <span className="text-[10px] text-gray-500 font-normal">({p.email})</span>}
                                                            </div>
                                                            <div className="text-xs text-gray-500 flex items-center gap-1">
                                                                <i data-lucide="link" className="w-3 h-3"></i> {window.location.origin}/?socio={p.slug}
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <button
                                                                onClick={() => {
                                                                    navigator.clipboard.writeText(`${window.location.origin}/?socio=${p.slug}`);
                                                                    showNotify("Copiado!", "Link copiado para a √°rea de transfer√™ncia.");
                                                                }}
                                                                className="px-3 py-1.5 bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white rounded-lg text-xs font-bold transition-all flex items-center gap-1.5"
                                                            >
                                                                <i data-lucide="copy" className="w-3.5 h-3.5"></i> Copiar
                                                            </button>
                                                            <button
                                                                onClick={() => handleEditPartner(p)}
                                                                className="px-3 py-1.5 bg-blue-500/10 hover:bg-blue-500 text-blue-400 hover:text-white rounded-lg text-xs font-bold transition-all flex items-center gap-1.5"
                                                            >
                                                                <i data-lucide="pencil" className="w-3.5 h-3.5"></i> Editar
                                                            </button>
                                                            <button
                                                                onClick={() => showConfirm("Confirmar Exclus√£o", `Tem certeza que deseja excluir o s√≥cio "${p.name}"? Esta a√ß√£o √© irrevers√≠vel.`, async () => {
                                                                    await db.collection('partners').doc(p.id).delete();
                                                                    showNotify("Exclu√≠do!", "S√≥cio removido com sucesso.");
                                                                })}
                                                                className="px-3 py-1.5 bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white rounded-lg text-xs font-bold transition-all flex items-center gap-1.5"
                                                            >
                                                                <i data-lucide="trash-2" className="w-3.5 h-3.5"></i> Excluir
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                                {partners.length === 0 && <div className="text-center py-8 text-gray-600 text-sm">Nenhum s√≥cio cadastrado.</div>}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Confirm Modal */}
                    <ConfirmModal
                        isOpen={modal.show}
                        onClose={() => setModal({ ...modal, show: false })}
                        onConfirm={modal.onConfirm}
                        title={modal.title}
                        message={modal.message}
                        type={modal.type}
                    />
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>

</html>